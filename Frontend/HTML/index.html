<!DOCTYPE html>
<html lang="ro">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Tracker — Products</title>
    <link href="Frontend/CSS/index_style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <h1>Price Tracker</h1>
                </div>
                <div class="header-actions" style="justify-content: flex-start;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <form class="scrape-form" id="scrape-form" style="margin-right: 0.5rem;">
                            <input type="text" class="scrape-input" placeholder="Query scrape..." id="scrape-query"
                                name="query">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-spider"></i>
                                Start scrape
                            </button>
                        </form>
                        <button type="button" id="scrape-settings-btn" style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;
                                   background:white;border:1.5px solid var(--border);border-radius:8px;box-shadow:var(--shadow);
                                   cursor:pointer;padding:0;margin-left:2px;">
                            <i class="fas fa-cog" style="font-size:1.3rem;color:var(--secondary);"></i>
                        </button>
                    </div>
                    <div class="export-dropdown">
                        <button class="btn btn-success" id="export-btn" type="button">
                            <i class="fas fa-download"></i>
                            Export
                        </button>
                        <div class="dropdown-menu" id="export-dropdown-menu">
                            <button type="button" class="dropdown-item" onclick="exportData('csv')">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                            <button type="button" class="dropdown-item" onclick="exportData('pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button type="button" class="dropdown-item" onclick="exportData('xlsx')">
                                <i class="fas fa-file-excel"></i> Excel (.xlsx)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="alert-success" class="alert success">
            <i class="fas fa-check-circle"></i>
            <span id="success-message"></span>
        </div>
        <div id="alert-error" class="alert error">
            <i class="fas fa-exclamation-circle"></i>
            <span id="error-message"></span>
        </div>

        <div class="filters">
            <form class="filter-row" id="filter-form">
                <div class="form-group">
                    <label class="form-label">Caută titlu</label>
                    <input type="text" class="form-input" id="filter-title" name="q" placeholder="Caută în titluri..."
                        autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label">Site</label>
                    <input type="text" class="form-input" id="filter-site" name="site" placeholder="ex: emag, altex"
                        autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label">Produse pe pagină</label>
                    <select class="form-select" id="per-page" name="per_page">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" id="open-scheduler-btn">
                        <i class="fas fa-clock"></i>
                        Scheduler
                    </button>
                </div>
            </form>
        </div>

        <div class="bulk-actions" id="bulk-actions">
            <form id="bulk-delete-form" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-bulk-delete" disabled id="bulk-delete-btn">
                    <i class="fas fa-trash"></i>
                    Șterge selectate (<span id="selected-count">0</span>)
                </button>
            </form>
            <button type="button" class="btn btn-primary" id="bulk-track-btn" style="margin-left:0.5rem; display:none;">
                <i class="fas fa-eye"></i>
                Urmărește prețul
            </button>
        </div>

        <div class="table-card">
            <table class="table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" class="checkbox" id="select-all">
                        </th>
                        <th>
                            <button type="button" class="table-header-btn" data-col="id"
                                onclick="HandleHeaderBtn('id')">
                                <span class="header-text">#</span>
                                <span class="table-header-arrow-placeholder"></span>
                            </button>
                        </th>
                        <th>
                            <button type="button" class="table-header-btn" data-col="site"
                                onclick="HandleHeaderBtn('site_name')">
                                <span class="header-text">Site</span>
                                <span class="table-header-arrow-placeholder"></span>
                            </button>
                        </th>
                        <th>
                            <button type="button" class="table-header-btn" data-col="title"
                                onclick="HandleHeaderBtn('title')">
                                <span class="header-text">Titlu</span>
                                <span class="table-header-arrow-placeholder"></span>
                            </button>
                        </th>
                        <th>
                            <button type="button" class="table-header-btn" data-col="price"
                                onclick="HandleHeaderBtn('last_price')">
                                <span class="header-text">Preț</span>
                                <span class="table-header-arrow-placeholder"></span>
                            </button>
                        </th>
                        <th>
                            <button type="button" class="table-header-btn" data-col="rating"
                                onclick="HandleHeaderBtn('rating')">
                                <span class="header-text">Rating</span>
                                <span class="table-header-arrow-placeholder"></span>
                            </button>
                        </th>
                        <th>
                            <button type="button" class="table-header-btn" data-col="updated"
                                onclick="HandleHeaderBtn('last_seen_at')">
                                <span class="header-text">Ultima actualizare</span>
                                <span class="table-header-arrow-placeholder"></span>
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody id="products-table">
                </tbody>
            </table>

            <div class="table-footer">
                <div>
                    Total: <strong id="total-products"></strong> produse
                </div>
                <div class="pagination"></div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Se încarcă...</div>
    </div>

    <div id="scrape-settings-modal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:2000;">
        <div
            style="background:white; max-width:400px; margin:40px auto; padding:2rem; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.15); position:relative;">
            <h2 style="margin-bottom:1rem;">Setări Scraping</h2>
            <form id="scrape-settings-form">
                <div style="margin-bottom:1rem;">
                    <label>Preț minim:</label>
                    <input type="number" min="0" step="1" id="scrape-min-price" name="min_price" class="form-input"
                        style="width:100%;">
                </div>
                <div style="margin-bottom:1rem;">
                    <label>Preț maxim:</label>
                    <input type="number" min="0" step="1" id="scrape-max-price" name="max_price" class="form-input"
                        style="width:100%;">
                </div>
                <div style="margin-bottom:1rem;">
                    <label>Rating minim:</label>
                    <input type="number" min="0" max="5" step="0.1" id="scrape-min-rating" name="min_rating"
                        class="form-input" style="width:100%;">
                </div>
                <div style="margin-bottom:1rem;">
                    <label>Număr minim rating-uri:</label>
                    <input type="number" min="0" step="1" id="scrape-min-ratings" name="min_ratings" class="form-input"
                        style="width:100%;">
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1.5rem;">
                    <div style="display:flex; align-items:center; gap:0.5rem;">
                        <button type="button" id="delete-db-btn-modal" style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;
                                   background:white;border:1.5px solid var(--danger);border-radius:8px;box-shadow:var(--shadow);
                                   cursor:pointer;padding:0;">
                            <i class="fas fa-trash" style="font-size:1.2rem;color:var(--danger);"></i>
                        </button>
                        <button type="button" id="site-config-btn" style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;
                                   background:white;border:1.5px solid var(--primary);border-radius:8px;box-shadow:var(--shadow);
                                   cursor:pointer;padding:0;">
                            <i class="fas fa-wrench" style="font-size:1.2rem;color:var(--primary);"></i>
                        </button>
                    </div>
                    <div style="display:flex; align-items:center; gap:0.5rem;">
                        <button type="button" class="btn btn-secondary" id="scrape-settings-cancel">Anulează</button>
                        <button type="submit" class="btn btn-primary">Salvează</button>
                    </div>
                </div>
            </form>
            <button id="scrape-settings-close"
                style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; color:#64748b; cursor:pointer;">&times;</button>
        </div>
    </div>

    <div id="delete-db-modal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:3000;">
        <div
            style="background:white; max-width:340px; margin:120px auto; padding:2rem 1.5rem; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.18); position:relative;">
            <h3 style="margin-bottom:1rem; color:var(--danger);">Ștergere bază de date</h3>
            <div style="margin-bottom:1.2rem; color:var(--secondary);">
                Sigur vrei să ștergi baza de date?<br>
                <b>Această acțiune este ireversibilă!</b>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:0.5rem;">
                <button type="button" class="btn btn-secondary" id="delete-db-cancel">Anulează</button>
                <button type="button" class="btn btn-danger" id="delete-db-confirm">Șterge</button>
            </div>
            <button id="delete-db-close"
                style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; color:#64748b; cursor:pointer;">&times;</button>
        </div>
    </div>

    <div id="site-config-modal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:4000;">
        <div
            style="background:white; max-width:700px; width:90vw; max-height:90vh; margin:40px auto; padding:2rem; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.18); position:relative; overflow-y:auto;">
            <h2 style="margin-bottom:1rem;">Configurare Site</h2>
            <div id="site-list" style="margin-bottom:1.5rem; display:flex; flex-wrap:wrap; align-items:center;"></div>
            <div id="site-properties" style="display:none;">
                <form id="site-properties-form"></form>
            </div>
            <div id="site-actions-row"
                style="display:flex; justify-content:space-between; align-items:center; gap:0.5rem; margin-top:1.5rem;">
                <button type="button" id="delete-site-btn"
                    style="background:white;border:1.5px solid var(--danger);border-radius:8px;color:var(--danger);font-size:1.3rem;cursor:pointer;display:none;align-items:center;justify-content:center;width:36px;height:36px;"
                    title="Șterge siteul">
                    <i class="fas fa-trash"></i>
                </button>
                <div style="display:flex; gap:0.5rem;">
                    <button type="button" class="btn btn-secondary" id="site-config-cancel">Anulează</button>
                    <button type="button" class="btn btn-primary" id="site-config-save"
                        style="display:none;">Salvează</button>
                </div>
            </div>
            <button id="site-config-close"
                style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; color:#64748b; cursor:pointer;">&times;</button>
        </div>
    </div>

    <div id="delete-site-modal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:4100;">
        <div
            style="background:white; max-width:340px; margin:120px auto; padding:2rem 1.5rem; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.18); position:relative;">
            <h3 style="margin-bottom:1rem; color:var(--danger);">Ștergere site</h3>
            <div id="delete-site-modal-msg" style="margin-bottom:1.2rem; color:var(--secondary);">
                Sigur vrei să ștergi acest site?<br>
                <b>Această acțiune este ireversibilă!</b>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:0.5rem;">
                <button type="button" class="btn btn-secondary" id="delete-site-cancel">Anulează</button>
                <button type="button" class="btn btn-danger" id="delete-site-confirm">Șterge</button>
            </div>
            <button id="delete-site-close"
                style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; color:#64748b; cursor:pointer;">&times;</button>
        </div>
    </div>

    <div id="bulk-delete-modal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:3100;">
        <div
            style="background:white; max-width:340px; margin:120px auto; padding:2rem 1.5rem; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.18); position:relative;">
            <h3 style="margin-bottom:1rem; color:var(--danger);" id="bulk-delete-modal-title">Ștergere produse selectate
            </h3>
            <div id="bulk-delete-modal-msg" style="margin-bottom:1.2rem; color:var(--secondary);"></div>
            <div style="display:flex; justify-content:flex-end; gap:0.5rem;">
                <button type="button" class="btn btn-secondary" id="bulk-delete-cancel">Anulează</button>
                <button type="button" class="btn btn-danger" id="bulk-delete-confirm">Șterge</button>
            </div>
            <button id="bulk-delete-close"
                style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; color:#64748b; cursor:pointer;">&times;</button>
        </div>
    </div>

    <div id="scheduler-modal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:2100;">
        <div
            style="background:white; max-width:400px; margin:40px auto; padding:2rem; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.15); position:relative;">
            <h2 style="margin-bottom:1rem;">Scheduler Scraping</h2>
            <form id="scheduler-form">
                <div style="margin-bottom:1rem;">
                    <label>Scrape query (leave empty to delete the scheduler):</label>
                    <input type="text" id="scheduler-query" name="query" class="form-input" style="width:100%;">
                </div>
                <div style="margin-bottom:1rem;">
                    <label>Ora (24H):</label>
                    <input type="time" id="scheduler-time" name="time" class="form-input" style="width:100%;" required
                        pattern="^([01]\d|2[0-3]):([0-5]\d)$">
                    <span id="scheduler-time-error" style="color:#ef4444;font-size:0.95em;display:none;"></span>
                </div>
                <div style="margin-bottom:1rem;">
                    <label>Discord user ID (pentru notificări):</label>
                    <input type="text" id="scheduler-discord" name="discord_user_id" class="form-input"
                        style="width:100%;" placeholder="ex: 123456789012345678">
                </div>
                <div style="display:flex; justify-content:flex-end; gap:0.5rem; margin-top:1.5rem;">
                    <button type="button" class="btn btn-secondary" id="scheduler-cancel">Anulează</button>
                    <button type="submit" class="btn btn-primary">Salvează</button>
                </div>
            </form>
            <button id="scheduler-close"
                style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; color:#64748b; cursor:pointer;">&times;</button>
        </div>
    </div>

    <script src="Frontend/JS/index_backend.js"></script>
</body>

</html>